---
title: ANALISIS DE EVENTOS SYSMON
date: 2024-12-29 00:35:00 -05:00
categories: [Seguridad Informática, Sysmon]
tags: [sysmon, análisis de seguridad, eventos, filtros]  # TAG names should always be lowercase
---


# Análisis de Eventos Sysmon: ProcessCreate y ProcessAccess, y el Uso de Filtros Avanzados

Este documento analiza dos eventos clave de Sysmon, `ProcessCreate` y `ProcessAccess`,  y la importancia del uso de filtros avanzados para optimizar la detección de amenazas.

## Eventos Sysmon: ProcessCreate y ProcessAccess

Sysmon proporciona una rica fuente de información sobre la actividad del sistema.  Dos eventos particularmente útiles para los analistas de seguridad son `ProcessCreate` y `ProcessAccess`.

### ProcessCreate (ID de evento 1)

Este evento se registra cada vez que se crea un nuevo proceso en el sistema.  Su información detallada permite la detección temprana de actividades maliciosas.

**Atributos principales:**

* `ProcessGuid`: Identificador único del proceso.
* `ProcessId`: ID del proceso.
* `Image`: Ruta completa del archivo ejecutable.
* `CommandLine`: Línea de comandos utilizada para ejecutar el proceso.
* `CurrentDirectory`: Directorio de trabajo actual del proceso.
* `User`: Usuario que inició el proceso.
* `LogonGuid`: Identificador único de la sesión de inicio de sesión.
* `LogonId`: ID de la sesión de inicio de sesión.
* `TerminalSessionId`: ID de la sesión de terminal.
* `IntegrityLevel`: Nivel de integridad del proceso.
* `Hashes`:  Hashes (MD5, SHA1, SHA256) del archivo ejecutable.
* `ParentProcessGuid`: Identificador único del proceso padre.
* `ParentProcessId`: ID del proceso padre.
* `ParentImage`: Ruta completa del ejecutable del proceso padre.
* `ParentCommandLine`: Línea de comandos del proceso padre.


**Escenarios de detección de amenazas:**

1. **Ejecución de herramientas de ataque:** La creación de procesos conocidos como herramientas de ataque (ej: `mimikatz.exe`) indica un posible compromiso.
2. **Identificación de procesos maliciosos:** Procesos con nombres sospechosos, rutas inusuales o líneas de comandos que indican descarga de malware o desactivación de defensas.


### ProcessAccess (ID de evento 10)

Este evento se registra cuando un proceso accede a otro proceso, a menudo utilizado para inyección de código o lectura de memoria.

**Atributos principales:**

* `SourceProcessGUID`: Identificador único del proceso de origen.
* `SourceProcessId`: ID del proceso de origen.
* `SourceThreadId`: ID del hilo del proceso de origen.
* `SourceImage`: Ruta completa del ejecutable del proceso de origen.
* `TargetProcessGUID`: Identificador único del proceso objetivo.
* `TargetProcessId`: ID del proceso objetivo.
* `TargetImage`: Ruta completa del ejecutable del proceso objetivo.
* `GrantedAccess`: Permisos de acceso otorgados.
* `CallTrace`: Traza de llamadas.


**Escenarios de detección de amenazas:**

1. **Inyección de código:** Acceso a otro proceso con permisos de escritura de memoria (`PROCESS_ALL_ACCESS`) seguido de comportamientos inusuales en el proceso objetivo.
2. **Acceso a procesos críticos:**  Monitoreo de accesos a procesos críticos como `lsass.exe` para detectar intentos de robo de credenciales.


## Uso de Filtros Avanzados en Sysmon

Sysmon genera una gran cantidad de eventos.  Los filtros avanzados son cruciales para reducir el ruido y mejorar la eficiencia del análisis.

### Ventajas de los filtros avanzados:

* **Reducción del ruido:**  Se centra en eventos relevantes para la seguridad, reduciendo el volumen de datos a analizar.
* **Mejora del rendimiento:**  Menos eventos registrados implican menor carga de E/S y uso de CPU.
* **Mejor uso del almacenamiento:**  Se requiere menos espacio de almacenamiento para los registros.
* **Análisis más eficiente:**  Análisis más rápido y preciso al enfocarse en datos relevantes.

### Desventajas de un mal diseño de filtros:

* **Pérdida de información importante:**  Filtros demasiado restrictivos pueden omitir eventos cruciales.
* **Aumento del ruido:**  Filtros mal definidos pueden generar más ruido que reducirlo.
* **Complejidad en la configuración:**  Requiere un buen conocimiento de Sysmon y las técnicas de ataque.


### Ejemplo de filtro efectivo:

Para reducir el ruido en un entorno de producción, se pueden excluir eventos `ProcessCreate` para procesos legítimos conocidos como `chrome.exe` o `svchost.exe`, siempre y cuando se verifique la ruta del ejecutable y se combinen con otras condiciones.

Otro ejemplo, enfocado en la técnica de *Timestomp*, se muestra a continuación:

```xml
<Sysmon schemaversion="4.30">
  <EventFiltering>
    <RuleGroup name="" groupRelation="or">
      <FileCreateTime onmatch="include">
        <!--Look for timestomping in temp folders-->
        <Image name="technique_id=T1099,technique_name=Timestomp" condition="begin with">C:\Temp</Image>
        <Image name="technique_id=T1099,technique_name=Timestomp" condition="begin with">C:\Windows\Temp</Image>
        <Image name="technique_id=T1099, technique_name=Timestomp" condition="begin with">C:\Tmp</Image>
      </FileCreateTime>
    </RuleGroup>
  </EventFiltering>
</Sysmon>
```